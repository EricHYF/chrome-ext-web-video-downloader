# 网页视频下载器 Chrome扩展

一个功能强大的Chrome浏览器扩展，用于检测、下载和转换网页中的视频资源，特别优化了对HLS流媒体的支持。

## 🚀 主要功能

### 视频检测
- **多格式支持**: 自动检测MP4、AVI、MOV、WMV、FLV、WebM、MKV等常见视频格式
- **HLS流媒体**: 专门优化的M3U8/HLS流媒体检测和下载
- **Blob URL处理**: 特别优化对blob://格式视频源的检测和下载
- **Video.js支持**: 专门支持Video.js播放器框架
- **实时监控**: 监控网页中的XMLHttpRequest、Fetch请求和Media元素
- **动态加载**: 检测通过JavaScript动态加载的视频内容

### 下载功能
- **批量下载**: 支持一键下载页面中检测到的所有视频
- **智能命名**: 根据页面标题和时间戳自动生成文件名
- **进度监控**: 实时显示下载进度和速度
- **断点续传**: 支持暂停和恢复下载（部分格式）

### HLS流处理
- **片段下载**: 自动解析M3U8播放列表，下载所有视频片段
- **并发下载**: 多线程并发下载提高效率
- **加密解密**: 支持AES-128-CBC加密的HLS流解密
- **自动合并**: 将多个TS片段合并为完整的视频文件

### 用户界面
- **直观操作**: 简洁美观的弹出窗口界面
- **详细信息**: 显示视频时长、大小、格式等元数据
- **快速预览**: 一键预览视频内容
- **链接复制**: 快速复制视频链接到剪贴板

## 📦 安装方法

### 开发者模式安装

1. **下载源码**
   ```bash
   git clone [repository-url]
   cd chrome-extension
   ```

2. **打开Chrome扩展管理页面**
   - 在Chrome浏览器中访问 `chrome://extensions/`
   - 或者通过菜单：更多工具 → 扩展程序

3. **启用开发者模式**
   - 点击右上角的"开发者模式"开关

4. **加载扩展**
   - 点击"加载已解压的扩展程序"
   - 选择chrome-extension文件夹

5. **确认安装**
   - 扩展图标应该出现在浏览器工具栏中

### 图标转换（必需）

先安装 Image Magic
```shell
brew install imagemagick
```

由于提供的是SVG格式图标，需要转换为PNG：

```bash
# 使用ImageMagick转换（需要先安装）
magick icons/icon.svg -background none -resize 16x16 icons/icon16.png
magick icons/icon.svg -background none -resize 48x48 icons/icon48.png
magick icons/icon.svg -background none -resize 128x128 icons/icon128.png
```

或使用在线SVG转PNG工具进行转换。

## 🛠️ 使用方法

### 基础使用

1. **访问视频网页**
   - 打开包含视频的网页
   - 等待页面完全加载

2. **打开扩展**
   - 点击浏览器工具栏中的扩展图标
   - 扩展会自动扫描页面中的视频

3. **选择下载**
   - 浏览检测到的视频列表
   - 点击单个视频的下载按钮
   - 或使用"下载全部"批量下载

### 高级设置

点击设置按钮可以配置：

- **下载路径**: 自定义下载文件夹
- **视频质量**: 选择下载的视频质量
- **合并选项**: 是否自动合并多段视频
- **文件名模板**: 自定义文件命名规则

### 支持的网站类型

- 在线教育平台（如您提到的chinapm.org）
- 视频分享网站
- 直播平台
- 新闻网站
- 社交媒体平台

## 🔧 技术架构

### 核心组件

```
chrome-extension/
├── manifest.json          # 扩展配置文件
├── background.js           # 后台服务脚本
├── content.js             # 内容脚本
├── injected.js            # 页面注入脚本
├── hls-downloader.js      # HLS下载器
├── popup.html             # 弹出窗口HTML
├── popup.css              # 弹出窗口样式
├── popup.js               # 弹出窗口逻辑
└── icons/                 # 图标文件
    ├── icon.svg
    ├── icon16.png
    ├── icon48.png
    └── icon128.png
```

### 工作流程

1. **注入检测脚本** - 在页面加载时注入视频检测代码
2. **监控网络请求** - 拦截可能的视频资源请求
3. **解析视频信息** - 提取视频元数据和下载链接
4. **用户交互** - 通过弹出窗口展示和操作
5. **下载处理** - 根据视频类型选择合适的下载策略

### API权限

- `activeTab`: 访问当前标签页
- `storage`: 保存用户设置
- `downloads`: 文件下载功能
- `webRequest`: 监控网络请求

## 🎯 使用场景

### 在线教育
- 下载课程视频离线观看
- 保存重要讲座内容
- 批量下载系列教程

### 内容创作
- 收集素材视频
- 备份直播录像
- 整理参考资料

### 个人娱乐
- 保存喜爱的视频内容
- 离线观看节省流量
- 建立个人视频库

## ⚠️ 注意事项

### 法律合规
- 请遵守网站的使用条款
- 尊重版权和知识产权
- 仅下载您有权限的内容
- 不用于商业用途

### 技术限制
- 某些DRM保护的内容无法下载
- 部分网站可能有反爬虫机制
- HLS流的解密功能可能不适用于所有加密方案
- 大文件下载可能影响浏览器性能

### 隐私安全
- 扩展不会收集或上传用户数据
- 所有处理都在本地进行
- 建议定期清理下载缓存

## 🔨 开发和自定义

### 修改检测规则

编辑 `injected.js` 中的 `isVideoRequest` 函数：

```javascript
function isVideoRequest(url) {
  const customPatterns = [
    /\.custom_format$/i,
    /\/custom_path\//i
  ];
  return customPatterns.some(pattern => pattern.test(url));
}
```

### 添加新的视频格式

在 `background.js` 中更新支持的格式：

```javascript
const videoPatterns = [
  "*://*/*.custom_format*",
  // 添加其他格式
];
```

### 自定义UI样式

修改 `popup.css` 来自定义界面外观：

```css
.custom-theme {
  --primary-color: #your-color;
  --secondary-color: #your-secondary-color;
}
```

## 🐛 故障排除

### 常见问题

**Q: 为什么检测不到视频？**
A: 
- 确保页面完全加载
- 尝试点击刷新按钮重新扫描
- 某些网站使用特殊的加载方式，可能需要手动触发视频播放

**Q: HLS视频下载失败？**
A: 
- 检查网络连接
- 某些HLS流可能有访问限制
- 尝试刷新页面后重新下载

**Q: 下载的文件无法播放？**
A: 
- 检查文件完整性
- 尝试使用VLC等专业播放器
- 某些格式可能需要特定的解码器

### 调试模式

1. 打开Chrome开发者工具（F12）
2. 查看Console标签页的错误信息
3. 在扩展管理页面检查扩展的错误日志

## 📝 更新日志

### v1.0.0
- 初始版本发布
- 基础视频检测功能
- HLS流下载支持
- 用户界面实现

## 🤝 贡献

欢迎提交问题报告和功能请求！

### 开发环境设置

1. Fork 此仓库
2. 创建特性分支
3. 提交更改
4. 发起Pull Request

## 📄 许可证

此项目仅供学习和研究使用。请遵守相关法律法规和网站使用条款。

---

**免责声明**: 本扩展仅作为技术演示，用户需自行承担使用风险，并确保遵守适用的法律法规。